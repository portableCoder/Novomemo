"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[367],{367:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});var i,n,l=a(9268),r=a(4257),s=a(6006),d=a(1971),o=a(5228),c=a(4453),E=a(1511),y=a(9384),S=a(1327),u=a(3906),w=a(828),T=a(4245),p=a(3823),x=a(3400),h=a(9791),f=e=>{let t=(0,h.Z)({"text-indigo-500":e.active,"bg-zinc-800":e.active});return(0,l.jsxs)("button",{...e,className:"flex flex-col justify-center items-center gap-y-2 p-2 rounded-md hover:bg-zinc-800 ".concat(t," ").concat(e.className||""),children:[e.icon,e.children]})},m=a(308),g=a(2875);(i=n||(n={})).SET_WYSIWYG="SET_WYSIWYG",i.SET_MD="SET_MD",i.SET_LABELS="SET_LABELS",i.SET_FAVORITE="SET_FAVORITE",i.SET_TITLE="SET_TITLE",i.SET_TYPE="SET_TYPE",i.SET_LABEL_VALUE="SET_LABEL_VALUE",i.SET_FOCUSED="SET_FOCUSED",i.RESET="RESET",i.SET_STATE="SET_STATE";let v={title:"",editorState:{markdown:"",wysiwyg:w.EditorState.createEmpty()},type:"wysiwyg",favorite:!1,labels:[],labelValue:"",focused:!1};function _(e,t){let{type:a,payload:i}=t;switch(a){case n.SET_WYSIWYG:return{...e,editorState:{markdown:e.editorState.markdown,wysiwyg:i}};case n.SET_MD:return{...e,editorState:{markdown:i,wysiwyg:e.editorState.wysiwyg}};case n.SET_TITLE:return{...e,title:i};case n.SET_FAVORITE:return{...e,favorite:i};case n.SET_FOCUSED:return{...e,focused:i};case n.SET_LABELS:return{...e,labels:i};case n.SET_LABEL_VALUE:return{...e,labelValue:i};case n.SET_TYPE:return{...e,type:i};case n.RESET:return v;case n.SET_STATE:return i;default:return e}}var j=a(6738),L=e=>{let t=e.refetch,[a,i,L,k,b,A,N]=(0,m.Z)(e=>[e.editingNote,e.setEditingNote,e.notes,e.isViewing,e.setIsViewing,e.isEditing,e.setEditing]),[C]=(0,m.Z)(e=>[e.localMode]),{value:I,set:Z}=(0,j.Z)("notes",{defaultValue:[],initializeWithValue:!0}),V=L[a||0],D=(0,m.Z)(e=>e.setSelectedMode);(0,m.Z)(e=>e.setSidebarOpen);let O=(0,m.Z)(e=>e.supabase),Y=(0,m.Z)(e=>e.session),[B,F]=(0,s.useState)(!1),[{title:R,editorState:U,favorite:M,type:W,labels:P,labelValue:z,focused:G},J]=(0,s.useReducer)(_,v);function q(){J({type:n.RESET}),i(null),b(!1),N(!1)}async function H(){let e={archived:!1,content:"wysiwyg"==W?JSON.stringify((0,w.convertToRaw)(U.wysiwyg.getCurrentContent())):U[W],editor:W,created:new Date().getTime(),favorite:M,labels:P,title:R,id:-1},a={data:e,uid:null==Y?void 0:Y.user.id};if(C&&(e.id=crypto.randomUUID()),A){if(e.id=V.id,e.created=V.created,C&&I){let t=I.findIndex(e=>e.id===V.id),a=[...I];a[t]=e,Z(a)}else await O.from("Notes").update(a).eq("id",e.id)}else C?Z([...I||[],e]):await O.from("Notes").upsert(a);t(),D(1),q()}let K=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(k||A){let e=V.content,t="";"wysiwyg"===V.editor?e=w.EditorState.createWithContent((0,w.convertFromRaw)(JSON.parse(V.content))):(e=w.EditorState.createEmpty(),t=V.content);let a={editorState:{markdown:t,wysiwyg:e},favorite:V.favorite,focused:!1,labels:V.labels,title:V.title,type:V.editor,labelValue:z};J({type:n.SET_STATE,payload:a})}},[k,A]),(0,l.jsxs)("div",{style:{height:"100vh"},className:"flex-col gap-y-2 flex py-16 md:py-8 overflow-y-scroll  w-full",children:[(0,l.jsx)("div",{children:(0,l.jsxs)("button",{onClick:()=>{D(1),q()},className:"flex items-center justify-center gap-x-2",children:[(0,l.jsx)(d.Z,{}),(0,l.jsx)("div",{children:"Back"})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{children:"Title"}),(0,l.jsx)(g.I,{disabled:k,value:k&&V.title||R,onChange:e=>J({type:n.SET_TITLE,payload:e.currentTarget.value}),placeholder:"Title"})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{children:["Labels ",!k&&(0,l.jsx)("span",{children:"(up to 5) "})," "]}),(0,l.jsxs)("div",{className:"flex rounded-md p-2 my-2  gap-x-2 border border-zinc-600 ".concat((0,h.Z)({"border-indigo-500":G})),children:[(k&&V.labels||P).map((e,t)=>(0,l.jsxs)("div",{className:"rounded-md border-zinc-500 border whitespace-nowrap flex gap-x-2 items-center justify-center bg-zinc-900 p-2",children:[e,!k&&(0,l.jsx)("button",{onClick:()=>{J({type:n.SET_LABELS,payload:P.filter((e,a)=>t!==a)})},children:(0,l.jsx)(o.Z,{})})]},t)),!k&&P.length<5&&(0,l.jsx)(g.I,{disabled:k,onFocus:e=>{J({type:n.SET_FOCUSED,payload:!0})},onBlur:()=>{J({type:n.SET_FOCUSED,payload:!1})},value:z,placeholder:"Enter labels",onChange:e=>J({type:n.SET_LABEL_VALUE,payload:e.currentTarget.value}),onKeyDown:e=>{"Enter"===e.key&&z.length>0&&(J({type:n.SET_LABEL_VALUE,payload:""}),J({type:n.SET_LABELS,payload:Array.from(new Set([...P,z]))}))},className:"border-none outline-0 outline-none px-2"})]})]}),"markdown"===W&&!B&&!k&&(0,l.jsx)(r.ML,{onChange:e=>{J({type:n.SET_MD,payload:e})},theme:"vs-dark",width:"100%",height:"100vh",value:U.markdown,defaultLanguage:"markdown"}),"markdown"===W&&(k||B)&&(0,l.jsx)("div",{style:{height:"80%"},className:"w-full overflow-y-scroll test-class",children:(0,l.jsx)(p.D,{remarkPlugins:[x.Z],children:k&&"markdown"===V.editor&&V.content||U.markdown})}),"wysiwyg"===W&&(0,l.jsx)(T.Editor,{ref:K,readOnly:B||k,wrapperStyle:{height:"70%",maxHeight:"80%"},editorState:U.wysiwyg,editorClassName:"w-full py-16",toolbarClassName:"text-black ".concat((B||k)&&"opacity-0"),onEditorStateChange:e=>J({type:n.SET_WYSIWYG,payload:e})}),(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between items-center my-6  py-4",children:[(0,l.jsxs)("div",{className:"w-full flex gap-x-3 text-xs",children:[!k&&(0,l.jsx)(f,{onClick:()=>{J({type:n.SET_FAVORITE,payload:!M})},active:M,icon:(0,l.jsx)(c.Z,{}),children:(0,l.jsx)("div",{children:"Favorite"})}),(k&&"wysiwyg"===W||A||!A&&!k)&&(0,l.jsx)(f,{active:"wysiwyg"===W,icon:(0,l.jsx)(E.Z,{}),onClick:()=>{J({type:n.SET_TYPE,payload:"wysiwyg"})},children:(0,l.jsx)("div",{children:"Editor Mode"})}),(k&&"markdown"===W||A||!A&&!k)&&(0,l.jsxs)(f,{icon:"",active:"markdown"===W,onClick:()=>{J({type:n.SET_TYPE,payload:"markdown"})},children:[(0,l.jsx)("div",{className:"italic",children:" MD "}),(0,l.jsx)("div",{children:"Markdown Mode"})]}),!k&&(0,l.jsx)(f,{icon:(0,l.jsx)(y.Z,{}),active:B,onClick:()=>{F(e=>!e)},children:(0,l.jsx)("div",{className:"whitespace-nowrap text-center",children:" Preview "})})]}),!k&&(0,l.jsx)(f,{onClick:H,className:"md:w-auto w-full my-2 flex flex-row",icon:"",children:(0,l.jsxs)("div",{className:"flex  gap-x-2 whitespace-nowrap text-center",children:[(0,l.jsxs)("div",{children:[A&&(0,l.jsx)(S.Z,{}),!A&&(0,l.jsx)(u.Z,{})]})," ",A?"Save note":"Add note"," "]})})]})]})}}}]);